<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# db

```go
import "github.com/brpaz/lib-go/storage/db"
```

## Index

- [Constants](<#constants>)
- [Variables](<#variables>)
- [func NewConnection\(opts ...ConnOptFunc\) \(\*gorm.DB, error\)](<#NewConnection>)
- [type ConnOptFunc](<#ConnOptFunc>)
  - [func WithAutomaticPing\(\) ConnOptFunc](<#WithAutomaticPing>)
  - [func WithConnMaxIdleTime\(connMaxIdleTime time.Duration\) ConnOptFunc](<#WithConnMaxIdleTime>)
  - [func WithConnMaxLifetime\(connMaxLifetime time.Duration\) ConnOptFunc](<#WithConnMaxLifetime>)
  - [func WithDSN\(dsn string\) ConnOptFunc](<#WithDSN>)
  - [func WithDefaultTransaction\(\) ConnOptFunc](<#WithDefaultTransaction>)
  - [func WithDriver\(driver string\) ConnOptFunc](<#WithDriver>)
  - [func WithLogger\(logger log.Logger\) ConnOptFunc](<#WithLogger>)
  - [func WithMaxIdleConns\(maxIdleConns int\) ConnOptFunc](<#WithMaxIdleConns>)
  - [func WithMaxOpenConns\(maxOpenConns int\) ConnOptFunc](<#WithMaxOpenConns>)
  - [func WithOtelMetrics\(\) ConnOptFunc](<#WithOtelMetrics>)
  - [func WithOtelTracing\(\) ConnOptFunc](<#WithOtelTracing>)
- [type ConnOpts](<#ConnOpts>)
  - [func \(c \*ConnOpts\) Validate\(\) error](<#ConnOpts.Validate>)


## Constants

<a name="DriverPostgres"></a>Constants

```go
const (
    DriverPostgres = "postgres"
)
```

## Variables

<a name="ErrDriverRequired"></a>

```go
var (
    ErrDriverRequired     = errors.New("driver is required")
    ErrDsnRequired        = errors.New("dsn is required")
    ErrDriverNotSupported = errors.New("driver is not supported")
)
```

<a name="NewConnection"></a>
## func [NewConnection](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L162>)

```go
func NewConnection(opts ...ConnOptFunc) (*gorm.DB, error)
```

NewConnection opens a new database connection using the provided options.

<a name="ConnOptFunc"></a>
## type [ConnOptFunc](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L82>)

ConnOptFunc is a function that modifies the ConnOpts.

```go
type ConnOptFunc func(*ConnOpts)
```

<a name="WithAutomaticPing"></a>
### func [WithAutomaticPing](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L141>)

```go
func WithAutomaticPing() ConnOptFunc
```

WithAutomaticPing enables automatic pinging of the database connection.

<a name="WithConnMaxIdleTime"></a>
### func [WithConnMaxIdleTime](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L134>)

```go
func WithConnMaxIdleTime(connMaxIdleTime time.Duration) ConnOptFunc
```

WithConnMaxIdleTime sets the maximum amount of time a connection may be idle before being closed.

<a name="WithConnMaxLifetime"></a>
### func [WithConnMaxLifetime](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L127>)

```go
func WithConnMaxLifetime(connMaxLifetime time.Duration) ConnOptFunc
```

WithConnMaxLifetime sets the maximum amount of time a connection may be reused.

<a name="WithDSN"></a>
### func [WithDSN](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L92>)

```go
func WithDSN(dsn string) ConnOptFunc
```

WithDSN sets the database DSN to use.

<a name="WithDefaultTransaction"></a>
### func [WithDefaultTransaction](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L148>)

```go
func WithDefaultTransaction() ConnOptFunc
```

WithDefaultTransaction enables the default transaction mode for the connection.

<a name="WithDriver"></a>
### func [WithDriver](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L85>)

```go
func WithDriver(driver string) ConnOptFunc
```

WithDriver sets the database driver to use.

<a name="WithLogger"></a>
### func [WithLogger](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L155>)

```go
func WithLogger(logger log.Logger) ConnOptFunc
```

WithLogger sets the logger to be used by the connection.

<a name="WithMaxIdleConns"></a>
### func [WithMaxIdleConns](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L113>)

```go
func WithMaxIdleConns(maxIdleConns int) ConnOptFunc
```

WithMaxIdleConns sets the maximum number of idle connections in the connection pool.

<a name="WithMaxOpenConns"></a>
### func [WithMaxOpenConns](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L120>)

```go
func WithMaxOpenConns(maxOpenConns int) ConnOptFunc
```

WithMaxOpenConns sets the maximum number of open connections in the connection pool.

<a name="WithOtelMetrics"></a>
### func [WithOtelMetrics](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L106>)

```go
func WithOtelMetrics() ConnOptFunc
```

WithOtelMetrics enables OpenTelemetry metrics for the database connection.

<a name="WithOtelTracing"></a>
### func [WithOtelTracing](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L99>)

```go
func WithOtelTracing() ConnOptFunc
```

WithOtelTracing enables OpenTelemetry tracing for the database connection.

<a name="ConnOpts"></a>
## type [ConnOpts](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L24-L36>)

ConnOpts contains the options for opening a new database connection.

```go
type ConnOpts struct {
    Driver             string
    DSN                string
    OtelTracing        bool
    OtelMetrics        bool
    MaxIdleConns       int
    MaxOpenConns       int
    ConnMaxLifetime    time.Duration
    ConnMaxIdleTime    time.Duration
    AutomaticPing      bool
    DefaultTransaction bool
    Logger             log.Logger
}
```

<a name="ConnOpts.Validate"></a>
### func \(\*ConnOpts\) [Validate](<https://github.com/brpaz/lib-go/blob/main/storage/db/connection.go#L65>)

```go
func (c *ConnOpts) Validate() error
```

Validate validates the connection options.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
