<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# testutil

```go
import "github.com/brpaz/lib-go/storage/db/testutil"
```

go:build test

## Index

- [type PgContainerOpts](<#PgContainerOpts>)
- [type PgOptFunc](<#PgOptFunc>)
  - [func WithPgConfigFile\(file string\) PgOptFunc](<#WithPgConfigFile>)
  - [func WithPgContainerImage\(image string\) PgOptFunc](<#WithPgContainerImage>)
  - [func WithPgDbName\(name string\) PgOptFunc](<#WithPgDbName>)
  - [func WithPgDbPassword\(pass string\) PgOptFunc](<#WithPgDbPassword>)
  - [func WithPgDbUser\(user string\) PgOptFunc](<#WithPgDbUser>)
  - [func WithPgInitScripts\(scripts ...string\) PgOptFunc](<#WithPgInitScripts>)
- [type TestPgContainer](<#TestPgContainer>)
  - [func InitPgTestContainer\(ctx context.Context, opts ...PgOptFunc\) \(\*TestPgContainer, error\)](<#InitPgTestContainer>)
  - [func \(c \*TestPgContainer\) GetConnection\(ctx context.Context\) \(\*sql.DB, error\)](<#TestPgContainer.GetConnection>)
  - [func \(c \*TestPgContainer\) GetDSN\(ctx context.Context\) \(string, error\)](<#TestPgContainer.GetDSN>)
  - [func \(c \*TestPgContainer\) Stop\(ctx context.Context\) error](<#TestPgContainer.Stop>)


<a name="PgContainerOpts"></a>
## type [PgContainerOpts](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L70-L77>)

PgContainerOpts contains the options for creating a PostgreSQL test container.

```go
type PgContainerOpts struct {
    ContainerImage string
    DbName         string
    DbUser         string
    DbPass         string
    InitScripts    []string
    ConfigFile     string
}
```

<a name="PgOptFunc"></a>
## type [PgOptFunc](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L80>)

PgOptFunc is a function that modifies PgContainerOpts.

```go
type PgOptFunc func(*PgContainerOpts)
```

<a name="WithPgConfigFile"></a>
### func [WithPgConfigFile](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L114>)

```go
func WithPgConfigFile(file string) PgOptFunc
```



<a name="WithPgContainerImage"></a>
### func [WithPgContainerImage](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L84>)

```go
func WithPgContainerImage(image string) PgOptFunc
```



<a name="WithPgDbName"></a>
### func [WithPgDbName](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L102>)

```go
func WithPgDbName(name string) PgOptFunc
```



<a name="WithPgDbPassword"></a>
### func [WithPgDbPassword](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L96>)

```go
func WithPgDbPassword(pass string) PgOptFunc
```



<a name="WithPgDbUser"></a>
### func [WithPgDbUser](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L90>)

```go
func WithPgDbUser(user string) PgOptFunc
```



<a name="WithPgInitScripts"></a>
### func [WithPgInitScripts](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L108>)

```go
func WithPgInitScripts(scripts ...string) PgOptFunc
```



<a name="TestPgContainer"></a>
## type [TestPgContainer](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L19-L23>)

TestPgContainer wraps a PostgreSQL test container and provides helper methods.

```go
type TestPgContainer struct {
    // contains filtered or unexported fields
}
```

<a name="InitPgTestContainer"></a>
### func [InitPgTestContainer](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L132>)

```go
func InitPgTestContainer(ctx context.Context, opts ...PgOptFunc) (*TestPgContainer, error)
```

InitPgTestContainer initializes a new PostgreSQL test container with customizable options. It accepts a variadic list of PgOptFunc to modify the default options.

<a name="TestPgContainer.GetConnection"></a>
### func \(\*TestPgContainer\) [GetConnection](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L41>)

```go
func (c *TestPgContainer) GetConnection(ctx context.Context) (*sql.DB, error)
```

GetConnection returns an active database connection to the PostgreSQL container. It ensures that the connection is established only once, even if called concurrently.

<a name="TestPgContainer.GetDSN"></a>
### func \(\*TestPgContainer\) [GetDSN](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L27>)

```go
func (c *TestPgContainer) GetDSN(ctx context.Context) (string, error)
```

GetDSN retrieves the PostgreSQL connection string for the container. It returns an error if the container is not initialized.

<a name="TestPgContainer.Stop"></a>
### func \(\*TestPgContainer\) [Stop](<https://github.com/brpaz/lib-go/blob/main/storage/db/testutil/postgres.go#L59>)

```go
func (c *TestPgContainer) Stop(ctx context.Context) error
```

Stop terminates the PostgreSQL container and closes the connection if it's open.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
