<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# health

```go
import "github.com/brpaz/lib-go/health"
```

package health provides functionality for implementing health checks in Go services. It includes some common health check implementations and a health check handler that can be used with HTTP servers.

## Index

- [Constants](<#constants>)
- [func Handler\(processor HealthProcessor\) http.HandlerFunc](<#Handler>)
- [type CheckResult](<#CheckResult>)
- [type Checker](<#Checker>)
- [type HealthProcessor](<#HealthProcessor>)
- [type HealthResult](<#HealthResult>)
- [type Option](<#Option>)
  - [func WithChecks\(checks ...Checker\) Option](<#WithChecks>)
  - [func WithClock\(clock timeutil.Clock\) Option](<#WithClock>)
  - [func WithDescription\(description string\) Option](<#WithDescription>)
  - [func WithName\(name string\) Option](<#WithName>)
  - [func WithRevision\(revision string\) Option](<#WithRevision>)
  - [func WithVersion\(version string\) Option](<#WithVersion>)
- [type Service](<#Service>)
  - [func New\(options ...Option\) \*Service](<#New>)
  - [func \(hs \*Service\) AddCheck\(check Checker\)](<#Service.AddCheck>)
  - [func \(hs \*Service\) Execute\(ctx context.Context\) HealthResult](<#Service.Execute>)


## Constants

<a name="StatusPass"></a>Status constants represent the possible statuses of a health check.

```go
const (
    StatusPass = "pass"
    StatusWarn = "warn"
    StatusFail = "fail"
)
```

<a name="Handler"></a>
## func [Handler](<https://github.com/brpaz/lib-go/blob/main/health/handler.go#L15>)

```go
func Handler(processor HealthProcessor) http.HandlerFunc
```

HandlerHealth returns an http.HandlerFunc that handles the health check request This function should be registered with your HTTP router to expose the health check endpoint. Example:

```
router := mux.NewRouter()
router.HandleFunc("/health", api.HandlerHealth(healthService)).Methods("GET")
http.ListenAndServe(":8080", router)
```

<a name="CheckResult"></a>
## type [CheckResult](<https://github.com/brpaz/lib-go/blob/main/health/health.go#L22-L27>)

Struct that represents the result of a health check. All checks must return an instance of this struct.

```go
type CheckResult struct {
    Status  string         `json:"status"`
    Message string         `json:"message,omitempty"`
    Error   error          `json:"-"`
    Details map[string]any `json:"details,omitempty"`
}
```

<a name="Checker"></a>
## type [Checker](<https://github.com/brpaz/lib-go/blob/main/health/health.go#L15-L18>)

Checker is the interface that must be implemented by every health check.

```go
type Checker interface {
    GetName() string
    Check(ctx context.Context) CheckResult
}
```

<a name="HealthProcessor"></a>
## type [HealthProcessor](<https://github.com/brpaz/lib-go/blob/main/health/health.go#L30-L32>)

HealthProcessor is an interface that should be implemented by the main health check service.

```go
type HealthProcessor interface {
    Execute(ctx context.Context) HealthResult
}
```

<a name="HealthResult"></a>
## type [HealthResult](<https://github.com/brpaz/lib-go/blob/main/health/health.go#L36-L45>)

HealthResult is the root response object for the health check endpoint. It aggregates the results of all available health checks and sets the overall status of the service.

```go
type HealthResult struct {
    Service     string                 `json:"service"`
    Description string                 `json:"description"`
    Version     string                 `json:"version"`
    Commit      string                 `json:"commit"`
    Status      string                 `json:"status"`
    Message     string                 `json:"message,omitempty"`
    Checks      map[string]CheckResult `json:"checks,omitempty"`
    Timestamp   int64                  `json:"timestamp"`
}
```

<a name="Option"></a>
## type [Option](<https://github.com/brpaz/lib-go/blob/main/health/service.go#L35>)

Option is a function that configures the HealthService.

```go
type Option func(*Service)
```

<a name="WithChecks"></a>
### func [WithChecks](<https://github.com/brpaz/lib-go/blob/main/health/service.go#L85>)

```go
func WithChecks(checks ...Checker) Option
```

WithChecks adds health checks to the HealthService.

<a name="WithClock"></a>
### func [WithClock](<https://github.com/brpaz/lib-go/blob/main/health/service.go#L91>)

```go
func WithClock(clock timeutil.Clock) Option
```



<a name="WithDescription"></a>
### func [WithDescription](<https://github.com/brpaz/lib-go/blob/main/health/service.go#L64>)

```go
func WithDescription(description string) Option
```



<a name="WithName"></a>
### func [WithName](<https://github.com/brpaz/lib-go/blob/main/health/service.go#L58>)

```go
func WithName(name string) Option
```

WithName sets the service name in the HealthService.

<a name="WithRevision"></a>
### func [WithRevision](<https://github.com/brpaz/lib-go/blob/main/health/service.go#L78>)

```go
func WithRevision(revision string) Option
```

WithRevision sets the revision in the HealthService.

<a name="WithVersion"></a>
### func [WithVersion](<https://github.com/brpaz/lib-go/blob/main/health/service.go#L71>)

```go
func WithVersion(version string) Option
```

WithVersion sets the version in the HealthService.

<a name="Service"></a>
## type [Service](<https://github.com/brpaz/lib-go/blob/main/health/service.go#L25-L32>)

Service is the main health check service. It implements the HealthProcessor interface and is responsible for executing all health checks registered in the service. Example Usage:

```
hs := health.New(
    health.WithName("my-service"),
    health.WithVersion("1.0.0"),
    health.WithRevision("abc123"),
    health.WithChecks(
        &checks.StubCheck{Result: true},
        &checks.StubCheck{Result: false},
    ),
)

healthResult := hs.Execute(context.Background())
```

```go
type Service struct {
    Name        string
    Description string
    Version     string
    Revision    string
    Checks      []Checker
    Clock       timeutil.Clock
}
```

<a name="New"></a>
### func [New](<https://github.com/brpaz/lib-go/blob/main/health/service.go#L44>)

```go
func New(options ...Option) *Service
```

New creates a new HealthService instance with the provided options.

<a name="Service.AddCheck"></a>
### func \(\*Service\) [AddCheck](<https://github.com/brpaz/lib-go/blob/main/health/service.go#L98>)

```go
func (hs *Service) AddCheck(check Checker)
```

AddCheck adds a new health check to the HealthService.

<a name="Service.Execute"></a>
### func \(\*Service\) [Execute](<https://github.com/brpaz/lib-go/blob/main/health/service.go#L103>)

```go
func (hs *Service) Execute(ctx context.Context) HealthResult
```

Execute runs all registered health checks and returns the aggregated result.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
